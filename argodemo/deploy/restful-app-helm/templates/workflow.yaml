---
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: hello-book-
  namespace: argo
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/sync-wave: "5"
spec:
  entrypoint: test-book
  templates:
  - name: test-book
    container: 
      image: docker.io/probaln/test-bookapp:v3
      command: ["sh"]
      args: ["integ-test/test-initialization.sh","http://a02a0afac49b5423184b755c9ae88e4d-801578416.us-east-2.elb.amazonaws.com:8080"]
---
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: fail-
  namespace: argo
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/sync-wave: "6"
spec:
  entrypoint: test-fail-steps

  templates:
  - name: test-fail-steps
    # Instead of just running a container, this template runs a seq of containers
    steps:
    - - name: Initialization
        template: test-book
        arguments:
          parameters:
          - name:  test_script_name
            value: integ-test/test-initialization.sh 
          - name: cluster_url
            value: http://a02a0afac49b5423184b755c9ae88e4d-801578416.us-east-2.elb.amazonaws.com:8080
    - - name: AddABook
        template: test-book
        arguments:
          parameters:
          - name:  test_script_name
            value: integ-test/test-add.sh 
          - name: cluster_url
            value: http://a02a0afac49b5423184b755c9ae88e4d-801578416.us-east-2.elb.amazonaws.com:8080
    - - name: AlwaysFailStep
        template: test-book
        arguments:
          parameters:
          - name:  test_script_name
            value: integ-test/test-update.sh 
          - name: cluster_url
            value: http://a02a0afac49b5423184b755c9ae88e4d-801578416.us-east-2.elb.amazonaws.com:8080
    - - name: UpdateBook
        template: test-book
        arguments:
          parameters:
          - name:  test_script_name
            value: integ-test/test-patch.sh 
          - name: cluster_url
            value: http://a02a0afac49b5423184b755c9ae88e4d-801578416.us-east-2.elb.amazonaws.com:8080
    - - name: DeleteABook
        template: test-book
        arguments:
          parameters:
          - name:  test_script_name
            value: integ-test/test-delete.sh 
          - name: cluster_url
            value: http://a02a0afac49b5423184b755c9ae88e4d-801578416.us-east-2.elb.amazonaws.com:8080

  - name: test-book
    inputs:
      parameters:
      - name: test_script_name
      - name: cluster_url
    container: 
      image: docker.io/probaln/test-bookapp:v3
      command: ["sh"]
      args: ["{{ `{{` }}inputs.parameters.test_script_name{{ `}}` }}", "{{ `{{` }}inputs.parameters.cluster_url{{ `}}` }}"]

